# 🤖 手机自动化工具

一个智能的Android手机UI自动化工具，通过自然语言描述即可执行手机操作任务。

![版本](https://img.shields.io/badge/版本-v2.1-blue)
![Python](https://img.shields.io/badge/Python-3.8+-green)
![平台](https://img.shields.io/badge/平台-Windows-lightgrey)

## ✨ 主要特性

- 🎯 **智能执行**：输入自然语言描述，AI自动执行手机操作
- 📊 **批量处理**：支持从Excel文件批量读取任务并执行
- 🖥️ **可视化界面**：现代化GUI界面，无需编程知识
- 📱 **设备管理**：自动检测和管理Android设备连接
- 🔒 **隐私保护**：自动识别并保护敏感信息
- 📁 **完整记录**：保存执行过程截图和操作记录

## 🚀 快速开始

### 1. 环境安装

**方式一：自动安装（推荐）**

```bash
双击运行 setup_environment.bat
```

**方式二：手动安装**

```bash
# 安装Python依赖
pip install -r requirements.txt

# 初始化设备连接
python -m uiautomator2 init
```

### 2. 设备准备

1. **开启开发者模式**：设置 → 关于手机 → 连续点击"版本号"7次
2. **开启USB调试**：设置 → 开发者选项 → USB调试
3. **连接手机**：USB连接并授权调试

### 3. 获取API密钥

1. 访问 [DashScope控制台](https://dashscope.console.aliyun.com/)
2. 注册并创建API密钥

### 4. 启动程序

```bash
python main.py
```

## 🖥️ 详细界面说明

### 启动前端界面

```bash
python gui_app_new.py
```

### 主界面布局

程序采用现代化GUI设计，主界面分为四个主要区域：

```
┌─────────────────────────────────────────────────────────────┐
│                    🤖 手机自动化工具 v2.0                    │
├─────────────────────┬───────────────────────────────────────┤
│                    │                                      │
│   📱 任务控制中心    │            ⚙️ 配置管理               │
│                    │                                      │
│  🔌 设备控制        │   📁 输出设置                        │
│  🎯 单个任务执行    │   🤖 AI模型设置                      │
│  📚 批量任务执行    │   🔒 隐私保护                        │
│                    │   📱 应用包名映射                    │
│                    │   🛠️ 快捷工具                        │
├─────────────────────┴───────────────────────────────────────┤
│                    📄 执行日志                              │
│  [2025-01-08 10:30:15] ✅ 设备连接成功                     │
│  [2025-01-08 10:30:20] 🚀 开始执行任务：在京东上查快递        │
│                                    [🗑️ 清空] [💾 保存]    │
├─────────────────────────────────────────────────────────────┤
│ ● 就绪    📱 Redmi K50                    🕐 10:30:25  v2.0 │
└─────────────────────────────────────────────────────────────┘
```

### 📱 任务控制中心

#### 🔌 设备控制区域

- **🔍 检测设备按钮**：点击检查Android设备连接状态
- **状态指示器**：
  - 🟢 绿色圆点：设备正常连接
  - 🟠 橙色圆点：设备连接异常
  - 🔴 红色圆点：设备未连接
- **设备信息显示**：显示当前连接的设备型号和状态

#### 🎯 单个任务执行区域

- **💭 任务输入框**：
  - 输入自然语言任务描述
  - 支持中文输入，如"在京东上查快递"
  - 点击框内可编辑任务内容
- **🚀 执行任务按钮**：
  - 开始执行当前输入的任务
  - 任务执行时按钮变为禁用状态
- **⏹️ 中断任务按钮**：
  - 强制中断正在执行的任务
  - 仅在任务运行时可用

#### 📚 批量任务执行区域

- **📄 Excel文件选择**：
  - 显示当前选择的Excel文件路径
  - **📁 浏览按钮**：选择新的Excel文件
  - **🔄 刷新按钮**：重新读取Excel文件内容
- **📋 工作表选择**：
  - 显示Excel文件中的所有Sheet页
  - 可多选不同的Sheet进行批量处理
  - **✅ 全选**：选择所有Sheet
  - **❌ 取消全选**：取消所有Sheet选择
- **📊 列选择**：
  - 下拉选择包含任务描述的列名
  - 自动识别包含"query"关键字的列
- **⚡ 批量执行按钮**：开始批量处理选中的任务

### ⚙️ 配置管理

#### 📁 输出设置

- **单个任务输出**：设置单次任务结果保存目录（默认：output）
- **批量任务输出**：设置批量任务结果保存目录（默认：batch_output）
- 每个设置项都有📁按钮用于浏览选择目录

#### 🤖 AI模型设置

- **API Key**：
  - 输入DashScope API密钥
  - 显示为密码形式保护隐私
- **最大执行次数**：
  - 设置单个任务的最大执行步骤数
  - 防止任务无限循环

#### 🔒 隐私保护

- **隐私保护开关**：
  - 开启后自动识别并遮蔽手机号码等敏感信息
  - 保护用户隐私数据

#### 📱 应用包名映射

- **添加新映射**：
  - 应用名：输入应用的中文名称
  - 包名：输入应用的Android包名
  - **➕ 添加按钮**：保存新的映射关系
- **映射列表**：
  - 显示所有已配置的应用映射
  - 支持双击编辑现有映射
- **操作按钮**：
  - **🗑️ 删除选中**：删除选中的映射
  - **🔄 重置为默认**：恢复内置的默认映射
  - **📱 常用应用**：快速添加常用应用映射

#### 🛠️ 快捷工具

- **📂 打开单个输出**：快速打开单个任务输出目录
- **📊 打开批量输出**：快速打开批量任务输出目录
- **🗑️ 清理输出目录**：清空所有输出目录（谨慎使用）
- **🔍 检查设备**：检查ADB连接和设备状态
- **📤 导出配置**：将当前配置导出为JSON文件
- **📥 导入配置**：从JSON文件导入配置

#### 配置操作

- **💾 保存配置**：保存所有当前设置
- **🔄 重置配置**：恢复到默认配置

### 📄 执行日志

- **日志显示区域**：
  - 实时显示任务执行过程
  - 支持滚动查看历史日志
  - 不同类型信息使用不同颜色：
    - 🟢 成功信息（绿色）
    - 🔴 错误信息（红色）
    - 🟠 警告信息（橙色）
    - 🔵 一般信息（蓝色）
- **日志操作**：
  - **🗑️ 清空日志**：清除所有显示的日志
  - **💾 保存日志**：将日志保存到文件
  - **📊 日志统计**：显示当前日志条数

### 🔍 状态栏

- **状态指示器**：显示程序当前运行状态
  - "就绪"：程序空闲，可以接受新任务
  - "正在执行任务..."：任务执行中
  - "任务执行完成"：任务成功完成
- **📱 设备信息**：显示当前连接的设备型号
- **🕐 时间显示**：实时显示当前时间
- **版本信息**：显示程序版本号

## 📋 使用示例

### 💡 首次使用流程

1. **配置环境**

   - 启动程序后，首先在"⚙️ 配置管理"区域配置API Key
   - 设置输出目录（可使用默认值）
   - 保存配置
2. **连接设备**

   - 确保手机已开启USB调试并连接电脑
   - 点击"🔍 检测设备"按钮
   - 查看状态指示器变为🟢绿色
3. **执行第一个任务**

   - 在任务输入框输入："打开设置"
   - 点击"🚀 执行任务"
   - 观察日志输出和手机操作

### 🎯 单个任务执行

#### 基本操作

1. 在"💭 任务输入框"中输入任务描述
2. 点击"🚀 执行任务"按钮
3. 观察执行日志和手机屏幕变化
4. 任务完成后可在输出目录查看结果

#### 任务描述示例

**电商购物**：

- `在京东上查快递`
- `打开淘宝搜索手机`
- `拼多多买水果`

**社交娱乐**：

- `微信发朋友圈`
- `刷抖音看视频`
- `网易云音乐播放歌曲`

**生活服务**：

- `美团外卖订餐`
- `滴滴打车到机场`
- `高德地图导航回家`

#### 任务监控

- 观察状态栏显示"正在执行任务..."
- 日志区域实时显示执行步骤
- 如需中断，点击"⏹️ 中断任务"

### 📊 批量任务执行

#### Excel文件准备

创建Excel文件，格式如下：

| 示例query      | 优先级 | 备注     |
| -------------- | ------ | -------- |
| 在京东上查快递 | 高     | 电商测试 |
| 淘宝搜索手机   | 中     | 搜索功能 |
| 美团订外卖     | 高     | 生活服务 |

#### 批量执行步骤

1. **选择文件**

   - 点击Excel文件选择区域的"📁 浏览"
   - 选择准备好的Excel文件
   - 点击"🔄 刷新"读取文件内容
2. **配置选项**

   - 在"📋 工作表选择"中勾选要处理的Sheet页
   - 在"📊 列选择"下拉框中选择包含任务的列（通常自动识别）
   - 确认配置无误
3. **开始执行**

   - 点击"⚡ 批量执行"按钮
   - 在确认对话框中检查执行信息
   - 点击"是"开始批量处理

#### 批量执行监控

- 程序会逐个执行每个任务
- 每个任务的结果保存在独立文件夹中
- 可随时点击"⏹️ 中断任务"停止批量执行

### ⚙️ 配置管理技巧

#### 应用包名映射

1. **快速添加常用应用**

   - 点击"📱 常用应用"按钮
   - 从预设列表中选择需要的应用
   - 批量添加到映射表
2. **手动添加应用**

   - 在"应用名"输入框输入中文名称
   - 在"包名"输入框输入Android包名
   - 点击"➕ 添加"保存
3. **编辑现有映射**

   - 双击映射列表中的项目
   - 修改后重新点击"➕ 添加"更新

#### 配置备份与恢复

- **导出配置**：点击"📤 导出配置"保存当前设置
- **导入配置**：点击"📥 导入配置"从文件恢复设置
- **重置配置**：点击"🔄 重置配置"恢复默认设置

### 🔧 实用技巧

#### 提高执行成功率

1. **清晰的任务描述**

   - 使用具体的应用名称："在京东上查快递"而不是"查快递"
   - 包含完整操作流程："打开微信，进入朋友圈，发布动态"
2. **设备状态检查**

   - 执行前确保手机屏幕解锁
   - 关闭可能干扰的弹窗和通知
   - 确保目标应用已安装
3. **网络环境**

   - 保持稳定的网络连接
   - 确保API调用额度充足

#### 调试和排错

1. **查看执行日志**

   - 关注红色错误信息
   - 注意任务执行的步骤流程
   - 保存日志用于问题分析
2. **使用设备检查**

   - 点击"🔍 检查设备"确认连接
   - 检查ADB工具是否正常
3. **调整执行参数**

   - 适当增加"最大执行次数"
   - 为复杂任务预留更多步骤

## 📂 输出结果

每个任务执行后会生成：

```
output/任务名称/
├── task.json      # 完整执行记录
├── 1-1.jpg        # 步骤截图
├── 1-1.xml        # 界面结构
└── 1-1_label.jpg  # 操作标记图
```

## ⚙️ 配置说明

### AI模型设置

- **deepseek-r1**：推荐，性能优秀（默认）
- **qwen-max**：阿里云最强模型
- **qwen-plus**：平衡性能

### 应用支持

内置支持50+常用应用，包括：

- 电商：京东、淘宝、拼多多、美团
- 社交：微信、QQ、微博、小红书
- 出行：滴滴、高德地图、12306
- 娱乐：爱奇艺、网易云音乐、抖音

## 🔧 故障排除

### 设备连接问题

```bash
# 检查设备
adb devices

# 重启ADB
adb kill-server
adb start-server
```

### 常见错误

- **设备未连接**：检查USB调试是否开启
- **API错误**：验证API密钥是否正确
- **任务失败**：确保任务描述清晰明确

## 📝 项目结构

```
phone_auto/
├── main.py              # 主程序入口
├── app/                 # GUI应用模块
│   ├── components/      # UI组件
│   ├── managers/        # 管理器
│   └── utils/          # 工具函数
├── src/                # 核心功能模块
│   ├── device_controller.py  # 设备控制
│   ├── ai_analyzer.py        # AI分析
│   └── task_executor.py      # 任务执行
├── output/             # 输出目录
└── requirements.txt    # 依赖列表
```

## 🌟 技术特色

- **精确定位**：基于XML结构分析，操作精度达95%+
- **智能启动**：三级应用启动策略，成功率近100%
- **高效处理**：文本模型分析，速度快3-5倍
- **低成本**：API调用成本降低60%以上

## 📄 许可证

本项目遵循 MIT 许可证。详见 [LICENSE](LICENSE) 文件。

## 🤝 贡献

欢迎提交Issue和Pull Request来改进项目！

## 📞 支持

如有问题或建议，请创建 [Issue](https://github.com/your-repo/issues) 或联系项目维护者。

---

**当前版本：** v2.1
**更新时间：** 2025年1月
**核心特色：** 现代化GUI界面 + 高精度XML分析 + 智能应用启动
